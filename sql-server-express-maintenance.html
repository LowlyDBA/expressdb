<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>What goes into a Maintenance Plan?</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.5f99cba3.js" as="script"><link rel="preload" href="/assets/js/2.e89d89ec.js" as="script"><link rel="preload" href="/assets/js/17.efcd3585.js" as="script"><link rel="prefetch" href="/assets/js/10.c5a37574.js"><link rel="prefetch" href="/assets/js/11.8f4a043b.js"><link rel="prefetch" href="/assets/js/12.b954a4a2.js"><link rel="prefetch" href="/assets/js/13.2e4dc4c0.js"><link rel="prefetch" href="/assets/js/14.70c932c8.js"><link rel="prefetch" href="/assets/js/15.d55386e9.js"><link rel="prefetch" href="/assets/js/16.e1de1bc7.js"><link rel="prefetch" href="/assets/js/18.8c8f5b78.js"><link rel="prefetch" href="/assets/js/19.edf14423.js"><link rel="prefetch" href="/assets/js/20.c772ad98.js"><link rel="prefetch" href="/assets/js/21.fe98756a.js"><link rel="prefetch" href="/assets/js/22.944d6f42.js"><link rel="prefetch" href="/assets/js/23.c9e9c560.js"><link rel="prefetch" href="/assets/js/24.685fc2ab.js"><link rel="prefetch" href="/assets/js/25.27dd32a9.js"><link rel="prefetch" href="/assets/js/26.0211fa9c.js"><link rel="prefetch" href="/assets/js/3.282f7d35.js"><link rel="prefetch" href="/assets/js/4.289f006a.js"><link rel="prefetch" href="/assets/js/5.a11c1157.js"><link rel="prefetch" href="/assets/js/6.6146f041.js"><link rel="prefetch" href="/assets/js/7.752ce999.js"><link rel="prefetch" href="/assets/js/8.d7ababa3.js"><link rel="prefetch" href="/assets/js/9.95fccf2c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="what-goes-into-a-maintenance-plan"><a href="#what-goes-into-a-maintenance-plan" class="header-anchor">#</a> What goes into a Maintenance Plan?</h2> <p>Unlike many other kinds of technology which generally stay static unless a
change is intentionally applied, databases are always evolving and changing
like a living being. And like all things that are alive, they need care and
maintenance to stay productive and healthy.</p> <p>Even for small databases, like those mandated by Express, database maintenance is a
key part of continuous performance and the proactive reduction of system errors. A standard
maintenance plan will address areas like:</p> <ul><li>Index rebuilds / reorganizations</li> <li>Updating statistics</li> <li>Backing up the database</li> <li>Cleaning old backup files</li> <li>Purging unnecessary data
<ul><li>System Data</li> <li>Application Data</li></ul></li></ul> <h2 id="best-maintenance-plan-practices-for-sql-server-express"><a href="#best-maintenance-plan-practices-for-sql-server-express" class="header-anchor">#</a> Best Maintenance Plan Practices for SQL Server Express</h2> <p>For the most part, maintenance on database of 10GB or less is straightforward. Most
systems are able to do index maintenance, update statistics, and purge old data extremely
quickly on a data set of this size. The size restriction removes many potentially complicated
scenarios where jobs must be run on individual partitions, by filegroups, or staggered across
different days of the week.</p> <p>Since SQL Server Express doesn't have SQL Agent, and thus doesn't have the GUI-focused
maintenance plan feature at all, maintenance must be achieved using T-SQL. Luckily, most seasoned
DBAs agree that T-SQL based maintenance plans are better than their GUI counterparts,
so general SQL Server best practices are applicable to Express.</p> <h3 id="ola-s-maintenance-scripts"><a href="#ola-s-maintenance-scripts" class="header-anchor">#</a> Ola's Maintenance Scripts</h3> <p>Just as <a href="https://ola.hallengren.com/sql-server-backup.html" target="_blank" rel="noopener noreferrer">Ola Hallengrens free scripts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are highly recommended for <a href="/sql-server-express-backups.html">SQL Express backups</a>, the same goes for his index and statistic scripts which help to make managing both areas extremely easy and customizable.</p> <p>By default, Ola's scripts use the following settings:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token variable">@FragmentationMedium</span> nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'INDEX_REORGANIZE,INDEX_REBUILD_ONLINE,INDEX_REBUILD_OFFLINE'</span><span class="token punctuation">,</span>
<span class="token variable">@FragmentationHigh</span> nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'INDEX_REBUILD_ONLINE,INDEX_REBUILD_OFFLINE'</span><span class="token punctuation">,</span>
<span class="token variable">@FragmentationLevel1</span> <span class="token keyword">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
<span class="token variable">@FragmentationLevel2</span> <span class="token keyword">int</span> <span class="token operator">=</span> <span class="token number">30</span>
</code></pre></div><p>These translate to nothing being done to an index that is less than 5% fragmented;
an attempt to reorganize, rebuild online, and rebuild offline (in that order) indexes fragmented more
than 5% but less than 30%; an attempt to rebuild online and rebuild offline (in that order)
if fragmentation is greater than 30%. Subsequent maintenance actions are only tried if the
one before is unavailable or not supported on an index. For SQL Server Express, online index rebuilds
are not available, so this option will always be skipped if not removed.</p> <p>These numbers are based off of Microsoft's BOL article <a href="https://docs.microsoft.com/en-us/sql/relational-databases/indexes/reorganize-and-rebuild-indexes" target="_blank" rel="noopener noreferrer">Reorganize and Rebuild Indexes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Though that article may <em>look</em> new and shiny, most of its contents are from a many years ago and most aspects (like fragmentation thresholds) have never been updated. With that in mind, some higher thresholds than the default are not only acceptable, but encouraged.</p> <p>A more modern take is setting the first fragmentation level to 30% and the second level to 80%. Some even
prefer to go higher (see further reading at the bottom). Adjusting Ola's defaults, by taking into consideration the lack of an online rebuild option and taking advantage of a few extra settings results in the following recommended script:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">EXECUTE</span> dbo<span class="token punctuation">.</span>IndexOptimize
<span class="token variable">@Databases</span> <span class="token operator">=</span> <span class="token string">'USER_DATABASES'</span><span class="token punctuation">,</span>
<span class="token variable">@FragmentationLow</span> <span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token variable">@FragmentationMedium</span> <span class="token operator">=</span> <span class="token string">'INDEX_REORGANIZE,INDEX_REBUILD_OFFLINE'</span><span class="token punctuation">,</span>
<span class="token variable">@FragmentationHigh</span> <span class="token operator">=</span> <span class="token string">'INDEX_REBUILD_OFFLINE'</span><span class="token punctuation">,</span>
<span class="token variable">@FragmentationLevel1</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span>
<span class="token variable">@FragmentationLevel2</span> <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">,</span>
<span class="token variable">@SortInTempdb</span> <span class="token operator">=</span> <span class="token string">'Y'</span><span class="token punctuation">,</span>
<span class="token variable">@FillFactor</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
<span class="token variable">@UpdateStatistics</span> <span class="token operator">=</span> <span class="token string">'Y'</span><span class="token punctuation">,</span>
<span class="token variable">@OnlyModifiedStatistics</span> <span class="token operator">=</span> <span class="token string">'Y'</span><span class="token punctuation">,</span>
<span class="token variable">@Indexes</span> <span class="token operator">=</span> <span class="token string">'ALL_INDEXES'</span><span class="token punctuation">,</span>
<span class="token variable">@LogToTable</span> <span class="token operator">=</span> <span class="token string">'Y'</span>
</code></pre></div><h4 id="fragmentation"><a href="#fragmentation" class="header-anchor">#</a> Fragmentation</h4> <p>Since taking an index offline for a rebuild isn't ideal, 80% makes sure that scenario isn't
occurring too often.</p> <h4 id="fill-factor"><a href="#fill-factor" class="header-anchor">#</a> Fill Factor</h4> <p>While normally a fill factor might need to be tweaked, it is
probably safe to keep at 100% (no padding in the index) to make sure that the database
files aren't hitting the 10GB limit earlier than is absolutely necessary.</p> <h4 id="update-statistics"><a href="#update-statistics" class="header-anchor">#</a> Update statistics</h4> <p>One of the great features of Ola's script is that it will update statistics after it
does the index rebuilds, since an index maintenance operation will automatically
update statistics in use by the index. This prevents duplication of work and
unnecessary transactions. Using the <code>@OnlyModifiedStatistics</code> flag further helps further by checking if a table's data has been altered since the last time
statistics were updated. If the table hasn't changed, then there is no reason to change
the statistics and it is skipped. This is especially helpful for archive tables or enum tables that
hardly or ever change, but may take up significant time to do statistics samplings on.</p> <h4 id="logging"><a href="#logging" class="header-anchor">#</a> Logging</h4> <p>Logging to the built-in table is extremely useful when tracking down a failed index job or
to analyze a growing trend in job runtime. It doesn't cost much to log each action,
but is key when hunting down problems with maintenance jobs.</p> <h3 id="other-maintenance-tasks"><a href="#other-maintenance-tasks" class="header-anchor">#</a> Other Maintenance Tasks</h3> <p>Backup pruning is conveniently handled by settings within Ola's script, so that part of
maintenance can be bundled right into the backup commands themselves (see the <a href="/best-practices/sql-server-express-backups/">Express Backup</a>) article for details.</p> <p>Data pruning is highly specific to an individual database's needs, so usually needs to be
developer a la carte. If you need help figuring this out for your databases, feel free to
reach out via the <a href="/author/contact/">contact page</a> to get more one-on-one help.</p> <h2 id="further-reading"><a href="#further-reading" class="header-anchor">#</a> Further Reading</h2> <ul><li>Brent Ozar's <a href="https://www.brentozar.com/archive/2014/12/tweaking-defaults-ola-hallengrens-maintenance-scripts/" target="_blank" rel="noopener noreferrer">Tweaking the Defaults for Ola Hallengren’s Maintenance Scripts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>RedGate's <a href="https://www.red-gate.com/simple-talk/sql/database-administration/automate-and-improve-your-database-maintenance-using-ola-hallengrens-free-script/" target="_blank" rel="noopener noreferrer">Automate and Improve Your Database Maintennace Using Ola Hallengren's Free Script<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <br> <br> <!----></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5f99cba3.js" defer></script><script src="/assets/js/2.e89d89ec.js" defer></script><script src="/assets/js/17.efcd3585.js" defer></script>
  </body>
</html>
